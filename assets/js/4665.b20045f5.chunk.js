"use strict";(self.webpackChunkjob_tracker_dashboard=self.webpackChunkjob_tracker_dashboard||[]).push([[4665],{4665(e,t,n){n.r(t),n.d(t,{default:()=>A});var s=n(22022),o=n(68701),r=n(96540),a=n(55689),i=n(73431);function l(e){return`board_order_v1:${e}`}function c(e){return"string"==typeof e&&new Set(i.YN.map(e=>String(e.value))).has(e)}function d(){const e={};for(const t of i.YN)e[t.value]=[];return e}function u(e){try{const t=localStorage.getItem(l(e));if(!t)return d();const n=JSON.parse(t),s=d();for(const e of i.YN){const t=e.value,o=Array.isArray(n?.[t])?n?.[t]:[];s[t]=o.filter(e=>"string"==typeof e)}return s}catch{return d()}}function m(e,t){try{localStorage.setItem(l(e),JSON.stringify(t))}catch{}}function f(e,t){const n=new Map;for(let e=0;e<t.length;e++)n.set(t[e],e);const s=e.map((e,t)=>({m:e,rank:n.has(e.id)?n.get(e.id):Number.MAX_SAFE_INTEGER,stable:t}));return s.sort((e,t)=>e.rank!==t.rank?e.rank-t.rank:e.stable-t.stable),s.map(e=>e.m)}var h=n(30537);function x(){const{userId:e}=(0,a.gv)(),{loops:t,matches:n,matchesQ:s}=function(){const e=(0,i.fZ)(),t=(0,h.g5)();return{loops:r.useMemo(()=>e.data??[],[e.data]),matches:r.useMemo(()=>t.data??[],[t.data]),matchesQ:r.useMemo(()=>({isLoading:t.isLoading,isError:t.isError,error:t.error}),[t.error,t.isError,t.isLoading])}}(),o=r.useMemo(()=>function(e){const t=new Map;for(const n of e)t.set(n.id,n.name);return t}(t),[t]),{orderByStatus:l,applyDrop:x}=function(e){const{userId:t,matches:n}=e,[s,o]=r.useState(()=>t?u(t):d());return r.useEffect(()=>{o(t?u(t):d())},[t]),r.useEffect(()=>{t&&o(e=>{const s={...e};return function(e,t){for(const t of i.YN){const n=t.value;Array.isArray(e[n])||(e[n]=[])}const n=new Set(t.map(e=>e.id));for(const t of i.YN){const s=t.value;e[s]=(e[s]??[]).filter(e=>n.has(e))}for(const n of t){const t=c(n.status)?n.status:"new",s=e[t]??(e[t]=[]);s.includes(n.id)||s.push(n.id)}}(s,n),m(t,s),s})},[n,t]),{orderByStatus:s,applyDrop:r.useCallback((e,n,s)=>{t&&o(o=>{const r={...o},a=[...r[e.fromStatus]??[]],i=e.fromStatus===n?a:[...r[n]??[]],l=a.indexOf(e.matchId);-1!==l&&a.splice(l,1);const c=Math.max(0,Math.min(s,i.length));return i.splice(c,0,e.matchId),r[e.fromStatus]=e.fromStatus===n?i:a,r[n]=i,m(t,r),r})},[t])}}({userId:e,matches:n}),{busy:p,onDeleteById:g,updateStatus:b}=function(){const[e,t]=(0,h.Xk)(),[n,s]=(0,h.LC)(),o=Boolean(t.isLoading||s.isLoading),a=r.useCallback(async t=>e(t),[e]),i=r.useCallback(async e=>n(e),[n]),l=r.useCallback(async(e,t)=>{const n=e.find(e=>e.id===t);n&&await a({matchId:n.id,loopId:n.loopId})},[a]);return{busy:o,deleteMatch:a,updateStatus:i,onDeleteById:l}}(),v=r.useMemo(()=>function(e,t){const n=function(e){const t=new Map;for(const e of i.YN)t.set(e.value,[]);for(const n of e)(t.get(n.status)??[]).push(n);return t}(e);for(const e of i.YN){const s=e.value,o=f(n.get(s)??[],t[s]??[]);n.set(s,o)}return n}(n,l),[n,l]),y=r.useCallback(e=>{g(n,e).catch(()=>{})},[n,g]),N=r.useCallback(async(t,s,o)=>{if(!e)return;if(p)return;if(x(t,s,o),t.fromStatus===s)return;const r=function(e,t){return e.find(e=>e.id===t)}(n,t.matchId);r&&await b({matchId:r.id,loopId:r.loopId,status:s})},[x,p,n,b,e]);return{busy:p,queries:{matchesQ:s},data:{matches:n,byStatus:v,loopIdToName:o},actions:{onDelete:y,onDropToStatus:N}}}var p=n(43375),g=n(43627),b=n(99653),v=n(74848);function y({status:e,children:t}){const n=`lane:${e}`,{setNodeRef:s,isOver:o}=(0,p.zM)({id:n});return(0,v.jsx)("div",{ref:s,className:(0,b.xW)("flex-1 min-h-0","rounded-xl border border-border bg-muted/40","p-md","overflow-y-auto overflow-x-hidden",o&&"bg-muted ring-2 ring-primary/40"),children:t})}var N=n(74979),S=n(32708);function j({match:e,loopName:t,busy:n,onDelete:a,overlay:i=!1}){const{t:l}=(0,s.Bd)(),[c,d]=r.useState(!1),u=r.useCallback(t=>{t.preventDefault(),t.stopPropagation(),n||i||window.confirm(l("board.deleteConfirm","Delete this job from the board?"))&&Promise.resolve(a(e.id)).catch(()=>{})},[n,i,a,e.id,l]),m=r.useMemo(()=>String(e.title??"").trim()||"—",[e.title]),f=r.useMemo(()=>String(e.company??"").trim()||"—",[e.company]),x=r.useMemo(()=>(0,h.v)(e.matchedAt),[e.matchedAt]),p=r.useMemo(()=>{const t=(0,h.FL)(e.platform);return t?t.toUpperCase():""},[e.platform]),g=r.useMemo(()=>[e.location,p,x,t].map(e=>String(e??"").trim()).filter(Boolean).join(" • "),[e.location,x,t,p]),y=r.useMemo(()=>String(e.url??"").trim(),[e.url]),N=Boolean(y),j=r.useCallback(()=>{n||i||d(!0)},[n,i]);let w;return w=i?"cursor-grabbing":n?"opacity-60 cursor-not-allowed":"cursor-grab",(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{role:"button",tabIndex:0,onClick:j,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||j()},className:(0,b.xW)("rounded-xl outline-none",w,"focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background"),children:(0,v.jsxs)(o.Zp,{variant:"default",padding:"md",shadow:"sm",interactive:!i,className:(0,b.xW)("relative flex flex-col gap-sm","transition-[box-shadow,transform] duration-fast ease-ease-out",!n&&!i&&"hover:shadow-md hover:-translate-y-[1px]",i&&"shadow-lg"),children:[i?null:(0,v.jsx)("button",{type:"button","aria-label":l("board.delete","Delete"),title:l("board.delete","Delete"),disabled:n,className:(0,b.xW)("absolute right-2 top-2","inline-flex h-8 w-8 items-center justify-center rounded-full","border border-border bg-card text-muted-foreground","shadow-sm","hover:bg-muted hover:text-foreground","disabled:opacity-50 disabled:cursor-not-allowed","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background"),onPointerDown:e=>{e.preventDefault(),e.stopPropagation()},onClick:u,children:(0,v.jsx)(S.A,{className:"h-4 w-4"})}),(0,v.jsxs)("div",{className:"min-w-0",children:[(0,v.jsxs)("div",{className:"min-w-0 whitespace-nowrap overflow-hidden text-ellipsis text-sm",children:[(0,v.jsx)("span",{className:"font-semibold text-foreground",children:m}),(0,v.jsx)("span",{className:"ml-2 text-muted-foreground",children:f})]}),g?(0,v.jsx)("div",{className:"mt-1 text-xs text-muted-foreground whitespace-nowrap overflow-hidden text-ellipsis",children:g}):null]}),N?(0,v.jsx)("div",{className:"pt-2",children:(0,v.jsx)("a",{href:y,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-primary underline hover:no-underline",onClick:e=>e.stopPropagation(),children:l("board.openLink","Open link")})}):null]})}),i?null:(0,v.jsx)(h.B6,{open:c,onOpenChange:d,match:e,loopName:t,busy:n,onDelete:e=>{Promise.resolve(a(e)).catch(()=>{})}})]})}function w({match:e,loopName:t,busy:n,onDelete:s,index:o}){const{setNodeRef:r,attributes:a,listeners:i,transform:l,transition:c,isDragging:d}=(0,g.gl)({id:e.id,disabled:n,data:{matchId:e.id,status:e.status,index:o}}),u={transform:N.Ks.Transform.toString(l),transition:c,opacity:d?.25:1};return(0,v.jsx)("div",{ref:r,style:u,className:(0,b.xW)("touch-none select-none",d&&"z-10"),...a,...i,children:(0,v.jsx)(j,{match:e,loopName:t,busy:n,onDelete:s,overlay:!1})})}function I({match:e,loopName:t,busy:n,onDelete:s}){return(0,v.jsx)("div",{className:"rotate-[1deg]",children:(0,v.jsx)(j,{match:e,loopName:t,busy:n,onDelete:s,overlay:!0})})}function D({status:e,title:t,matches:n,loopIdToName:a,busy:i,onDelete:l}){const{t:c}=(0,s.Bd)(),d=r.useMemo(()=>n.map(e=>e.id),[n]);return(0,v.jsxs)("div",{className:"w-[320px] shrink-0 h-full min-h-0 flex flex-col",children:[(0,v.jsx)(o.Zp,{variant:"subtle",padding:"md",shadow:"none",className:"shrink-0 mb-md",children:(0,v.jsxs)("div",{className:"flex items-center justify-between",children:[(0,v.jsx)("div",{className:"text-sm font-semibold text-foreground",children:t}),(0,v.jsx)("div",{className:"text-xs text-muted-foreground",children:n.length})]})}),(0,v.jsxs)(y,{status:e,children:[(0,v.jsx)(g.gB,{id:e,items:d,strategy:g._G,children:(0,v.jsx)("div",{className:"flex flex-col gap-md",children:n.map((e,t)=>(0,v.jsx)(w,{match:e,loopName:a.get(e.loopId)??"",busy:i,onDelete:l,index:t},e.id))})}),0===n.length?(0,v.jsx)("div",{className:"pt-md text-xs text-muted-foreground",children:c("board.dropHere","Drop matches here.")}):null]})]})}function k(e){const t=new Map;for(const n of i.YN)t.set(n.value,[...e.data.byStatus.get(n.value)??[]]);return t}function M(e,t){for(const[n,s]of e.entries())if(s.some(e=>e.id===t))return n;return null}function C(e,t){const n=e.findIndex(e=>e.id===t);if(-1===n)return{next:e,item:null};const s=e[n];return{next:[...e.slice(0,n),...e.slice(n+1)],item:s}}function E(e,t,n){const s=Math.max(0,Math.min(n,e.length));return[...e.slice(0,s),t,...e.slice(s)]}function B({vm:e}){const{t}=(0,s.Bd)(),{sensors:n,columnsState:o,activeMatch:a,activeLoopName:l,handleDragStart:c,handleDragOver:d,handleDragEnd:u}=function(e){const t=(0,p.FR)((0,p.MS)(p.AN,{activationConstraint:{distance:6}})),[n,s]=r.useState(()=>k(e)),[o,a]=r.useState(null),i=r.useRef(null);r.useEffect(()=>{if(o)return;const t=i.current;if(t){const n=e.data.byStatus.get(t.toStatus)??[],s=n.findIndex(e=>e.id===t.matchId),o=s===t.toIndex||t.toIndex>=n.length&&s===n.length-1;if(-1===s||!o)return;i.current=null}s(k(e))},[e.data.byStatus,e.data.matches,o,e]);const l=r.useMemo(()=>{if(!o)return null;for(const e of n.values()){const t=e.find(e=>e.id===o);if(t)return t}return null},[o,n]),c=r.useMemo(()=>l?e.data.loopIdToName.get(l.loopId)??"":"",[l,e.data.loopIdToName]),d=r.useRef(null),u=r.useCallback(e=>{const t=String(e.active.id);a(t);const s=M(n,t)??l?.status,o=s?n.get(s)?.findIndex(e=>e.id===t)??0:0;d.current=s?{matchId:t,fromStatus:s,fromIndex:o}:null},[n,l]),m=r.useCallback(e=>{const{active:t,over:n}=e;if(!n)return;const o=String(t.id),r=String(n.id),a=t.rect.current.translated&&t.rect.current.translated.top>n.rect.top+n.rect.height/2?1:0;s(e=>{const t=function(e){const t=new Map;for(const[n,s]of e.entries())t.set(n,[...s]);return t}(e),s=M(t,o);if(!s)return e;const i=(l=r).startsWith("lane:")?l.slice(5):null;var l;const c=n.data.current?.sortable,d=c?.containerId??i??M(t,r);if(!d)return e;const u=t.get(s)??[],m=t.get(d)??[],f="number"==typeof c?.index?c.index+a:m.length;if(s===d){const n=u.findIndex(e=>e.id===o);if(-1===n)return e;let r=f;if(r>n&&(r-=1),n===r)return e;const{next:a,item:i}=C(u,o);return i?(t.set(s,E(a,i,r)),t):e}const{next:h,item:x}=C(u,o);return x?(t.set(s,h),t.set(d,E(m,x,f)),t):e})},[]),f=r.useCallback(async t=>{const{active:o,over:r}=t,l=d.current;if(d.current=null,a(null),!l)return;if(!r)return void s(k(e));const c=String(o.id),u=M(n,c);if(!u)return void s(k(e));const m=(n.get(u)??[]).findIndex(e=>e.id===c);i.current={matchId:c,toStatus:u,toIndex:Math.max(0,m)};try{await e.actions.onDropToStatus({matchId:c,fromStatus:l.fromStatus,fromIndex:l.fromIndex},u,Math.max(0,m))}catch{i.current=null,s(k(e))}},[n,e]);return{sensors:t,columnsState:n,activeId:o,activeMatch:l,activeLoopName:c,handleDragStart:u,handleDragOver:m,handleDragEnd:f}}(e);return(0,v.jsxs)(p.Mp,{sensors:n,collisionDetection:p.y$,onDragStart:c,onDragOver:d,onDragEnd:u,children:[(0,v.jsx)("div",{className:"h-full min-h-0 flex items-stretch gap-md min-w-max",children:i.YN.map(n=>{const s=n.value,r=o.get(s)??[];return(0,v.jsx)(D,{status:s,title:t(`board.status.${s}`,n.label),matches:r,loopIdToName:e.data.loopIdToName,busy:e.busy,onDelete:e.actions.onDelete},s)})}),(0,v.jsx)(p.Hd,{adjustScale:!1,children:a?(0,v.jsx)("div",{className:"w-[320px]",children:(0,v.jsx)(I,{match:a,loopName:l,busy:e.busy,onDelete:e.actions.onDelete})}):null})]})}function L({matchesQ:e,isEmpty:t,children:n}){const{t:r}=(0,s.Bd)();return e.isLoading?(0,v.jsx)(o.xS,{children:r("board.loading","Loading matches…")}):e.isError?(0,v.jsx)(o.xS,{children:(0,b.u1)(e.error)}):t?(0,v.jsx)(o.xS,{children:r("board.empty","No matches yet.")}):(0,v.jsx)(v.Fragment,{children:n})}function A(){const e=x(),{t}=(0,s.Bd)(),n=e.queries.matchesQ,r=0===e.data.matches.length,a=t("board.title","Board"),i=t("board.subtitle","Drag matches between columns to update status.");return(0,v.jsxs)("div",{className:"h-full min-h-0 flex flex-col overflow-hidden",children:[(0,v.jsx)(o.zY,{title:a,subtitle:i}),(0,v.jsx)("div",{className:"flex-1 min-h-0 overflow-x-auto overflow-y-hidden",children:(0,v.jsx)(L,{matchesQ:n,isEmpty:r,children:(0,v.jsx)(B,{vm:e})})})]})}}}]);
//# sourceMappingURL=4665.b20045f5.chunk.js.map