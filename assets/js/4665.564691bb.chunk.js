"use strict";(self.webpackChunkjob_tracker_dashboard=self.webpackChunkjob_tracker_dashboard||[]).push([[4665],{4665(e,t,n){n.r(t),n.d(t,{default:()=>T});var s=n(22022),r=n(68701),o=n(96540),a=n(20410),i=n(73431);function l(e){return`board_order_v1:${e}`}function c(e){return"string"==typeof e&&new Set(i.YN.map(e=>String(e.value))).has(e)}function d(){const e={};for(const t of i.YN)e[t.value]=[];return e}function u(e){try{const t=localStorage.getItem(l(e));if(!t)return d();const n=JSON.parse(t),s=d();for(const e of i.YN){const t=e.value,r=Array.isArray(n?.[t])?n?.[t]:[];s[t]=r.filter(e=>"string"==typeof e)}return s}catch{return d()}}function m(e,t){try{localStorage.setItem(l(e),JSON.stringify(t))}catch{}}function f(e,t){const n=new Map;for(let e=0;e<t.length;e++)n.set(t[e],e);const s=e.map((e,t)=>({m:e,rank:n.has(e.id)?n.get(e.id):Number.MAX_SAFE_INTEGER,stable:t}));return s.sort((e,t)=>e.rank!==t.rank?e.rank-t.rank:e.stable-t.stable),s.map(e=>e.m)}var h=n(30537);function x(){const{userId:e}=(0,a.gv)(),{loops:t,matches:n,matchesQ:s}=function(){const e=(0,i.fZ)(),t=(0,h.g5)();return{loops:o.useMemo(()=>e.data??[],[e.data]),matches:o.useMemo(()=>t.data??[],[t.data]),matchesQ:o.useMemo(()=>({isLoading:t.isLoading,isError:t.isError,error:t.error}),[t.error,t.isError,t.isLoading])}}(),r=o.useMemo(()=>function(e){const t=new Map;for(const n of e)t.set(n.id,n.name);return t}(t),[t]),{orderByStatus:l,applyDrop:x}=function(e){const{userId:t,matches:n}=e,[s,r]=o.useState(()=>t?u(t):d());return o.useEffect(()=>{r(t?u(t):d())},[t]),o.useEffect(()=>{t&&r(e=>{const s={...e};return function(e,t){for(const t of i.YN){const n=t.value;Array.isArray(e[n])||(e[n]=[])}const n=new Set(t.map(e=>e.id));for(const t of i.YN){const s=t.value;e[s]=(e[s]??[]).filter(e=>n.has(e))}for(const n of t){const t=c(n.status)?n.status:"new",s=e[t]??(e[t]=[]);s.includes(n.id)||s.push(n.id)}}(s,n),m(t,s),s})},[n,t]),{orderByStatus:s,applyDrop:o.useCallback((e,n,s)=>{t&&r(r=>{const o={...r},a=[...o[e.fromStatus]??[]],i=e.fromStatus===n?a:[...o[n]??[]],l=a.indexOf(e.matchId);-1!==l&&a.splice(l,1);const c=Math.max(0,Math.min(s,i.length));return i.splice(c,0,e.matchId),o[e.fromStatus]=e.fromStatus===n?i:a,o[n]=i,m(t,o),o})},[t])}}({userId:e,matches:n}),{busy:p,onDeleteById:b,updateStatus:g}=function(){const[e,t]=(0,h.Xk)(),[n,s]=(0,h.LC)(),r=Boolean(t.isLoading||s.isLoading),a=o.useCallback(async t=>e(t),[e]),i=o.useCallback(async e=>n(e),[n]),l=o.useCallback(async(e,t)=>{const n=e.find(e=>e.id===t);n&&await a({matchId:n.id,loopId:n.loopId})},[a]);return{busy:r,deleteMatch:a,updateStatus:i,onDeleteById:l}}(),v=o.useMemo(()=>function(e,t){const n=function(e){const t=new Map;for(const e of i.YN)t.set(e.value,[]);for(const n of e)(t.get(n.status)??[]).push(n);return t}(e);for(const e of i.YN){const s=e.value,r=f(n.get(s)??[],t[s]??[]);n.set(s,r)}return n}(n,l),[n,l]),y=o.useCallback(e=>{b(n,e).catch(()=>{})},[n,b]),N=o.useCallback(async(t,s,r)=>{if(!e)return;if(p)return;if(x(t,s,r),t.fromStatus===s)return;const o=function(e,t){return e.find(e=>e.id===t)}(n,t.matchId);o&&await g({matchId:o.id,loopId:o.loopId,status:s})},[x,p,n,g,e]);return{busy:p,queries:{matchesQ:s},data:{matches:n,byStatus:v,loopIdToName:r},actions:{onDelete:y,onDropToStatus:N}}}var p=n(43375),b=n(43627),g=n(99653),v=n(74848);function y({status:e,children:t}){const n=`lane:${e}`,{setNodeRef:s,isOver:r}=(0,p.zM)({id:n});return(0,v.jsx)("div",{ref:s,className:(0,g.xW)("flex-1 min-h-0","rounded-xl border border-border bg-muted/40","p-sm md:p-md","overflow-y-auto overflow-x-hidden",r&&"bg-muted ring-2 ring-primary/40"),children:t})}var N=n(74979),w=n(32708);function j({match:e,loopName:t,busy:n,onDelete:a,overlay:i=!1}){const{t:l}=(0,s.Bd)(),[c,d]=o.useState(!1),u=o.useCallback(t=>{t.preventDefault(),t.stopPropagation(),n||i||window.confirm(l("board.deleteConfirm","Delete this job from the board?"))&&Promise.resolve(a(e.id)).catch(()=>{})},[n,i,a,e.id,l]),m=o.useMemo(()=>String(e.title??"").trim()||"—",[e.title]),f=o.useMemo(()=>String(e.company??"").trim()||"—",[e.company]),x=o.useMemo(()=>(0,h.v)(e.matchedAt),[e.matchedAt]),p=o.useMemo(()=>{const t=(0,h.FL)(e.platform);return t?t.toUpperCase():""},[e.platform]),b=o.useMemo(()=>[e.location,p,x,t].map(e=>String(e??"").trim()).filter(Boolean).join(" • "),[e.location,x,t,p]),y=o.useMemo(()=>String(e.url??"").trim(),[e.url]),N=Boolean(y),j=o.useCallback(()=>{n||i||d(!0)},[n,i]);let S;return S=i?"cursor-grabbing":n?"opacity-60 cursor-not-allowed":"cursor-pointer md:cursor-grab",(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{role:"button",tabIndex:0,onClick:j,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||j()},className:(0,g.xW)("rounded-xl outline-none",S,"focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background"),children:(0,v.jsxs)(r.Zp,{variant:"default",padding:"md",shadow:"sm",interactive:!i,className:(0,g.xW)("relative flex flex-col gap-sm","transition-[box-shadow,transform] duration-fast ease-ease-out",!n&&!i&&"hover:shadow-md hover:-translate-y-[1px]",i&&"shadow-lg"),children:[i?null:(0,v.jsx)("button",{type:"button","aria-label":l("board.delete","Delete"),title:l("board.delete","Delete"),disabled:n,className:(0,g.xW)("absolute right-2 top-2","inline-flex h-10 w-10 md:h-8 md:w-8 items-center justify-center rounded-full","border border-border bg-card text-muted-foreground","shadow-sm","hover:bg-muted hover:text-foreground","disabled:opacity-50 disabled:cursor-not-allowed","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background"),onPointerDown:e=>{e.preventDefault(),e.stopPropagation()},onClick:u,children:(0,v.jsx)(w.A,{className:"h-5 w-5 md:h-4 md:w-4"})}),(0,v.jsxs)("div",{className:"min-w-0",children:[(0,v.jsxs)("div",{className:"min-w-0 whitespace-nowrap overflow-hidden text-ellipsis text-sm",children:[(0,v.jsx)("span",{className:"font-semibold text-foreground",children:m}),(0,v.jsx)("span",{className:"ml-2 text-muted-foreground",children:f})]}),b?(0,v.jsx)("div",{className:"mt-1 text-xs text-muted-foreground whitespace-nowrap overflow-hidden text-ellipsis",children:b}):null]}),N?(0,v.jsx)("div",{className:"pt-2",children:(0,v.jsx)("a",{href:y,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-primary underline hover:no-underline",onClick:e=>e.stopPropagation(),children:l("board.openLink","Open link")})}):null]})}),i?null:(0,v.jsx)(h.B6,{open:c,onOpenChange:d,match:e,loopName:t,busy:n,onDelete:e=>{Promise.resolve(a(e)).catch(()=>{})}})]})}function S({match:e,loopName:t,busy:n,onDelete:s,index:r}){const{setNodeRef:o,attributes:a,listeners:i,transform:l,transition:c,isDragging:d}=(0,b.gl)({id:e.id,disabled:n,data:{matchId:e.id,status:e.status,index:r}}),u={transform:N.Ks.Transform.toString(l),transition:c,opacity:d?.25:1};return(0,v.jsx)("div",{ref:o,style:u,className:(0,g.xW)("select-none touch-pan-y touch-manipulation md:touch-none",d&&"z-10"),...a,...i,children:(0,v.jsx)(j,{match:e,loopName:t,busy:n,onDelete:s,overlay:!1})})}function I({match:e,loopName:t,busy:n,onDelete:s}){return(0,v.jsx)("div",{className:"rotate-[1deg]",children:(0,v.jsx)(j,{match:e,loopName:t,busy:n,onDelete:s,overlay:!0})})}function k({status:e,title:t,matches:n,loopIdToName:a,busy:i,onDelete:l}){const{t:c}=(0,s.Bd)(),d=o.useMemo(()=>n.map(e=>e.id),[n]);return(0,v.jsxs)("div",{className:"w-[calc(100vw-2rem)] md:w-[320px] shrink-0 h-full min-h-0 flex flex-col",children:[(0,v.jsx)(r.Zp,{variant:"subtle",padding:"md",shadow:"none",className:"shrink-0 mb-sm md:mb-md",children:(0,v.jsxs)("div",{className:"flex items-center justify-between",children:[(0,v.jsx)("div",{className:"text-sm font-semibold text-foreground",children:t}),(0,v.jsx)("div",{className:"text-xs text-muted-foreground",children:n.length})]})}),(0,v.jsxs)(y,{status:e,children:[(0,v.jsx)(b.gB,{id:e,items:d,strategy:b._G,children:(0,v.jsx)("div",{className:"flex flex-col gap-sm md:gap-md",children:n.map((e,t)=>(0,v.jsx)(S,{match:e,loopName:a.get(e.loopId)??"",busy:i,onDelete:l,index:t},e.id))})}),0===n.length?(0,v.jsx)("div",{className:"pt-md text-xs text-muted-foreground",children:c("board.dropHere","Drop matches here.")}):null]})]})}function D(e){const t=new Map;for(const n of i.YN)t.set(n.value,[...e.data.byStatus.get(n.value)??[]]);return t}function M(e,t){for(const[n,s]of e.entries())if(s.some(e=>e.id===t))return n;return null}function C(e,t){const n=e.findIndex(e=>e.id===t);if(-1===n)return{next:e,item:null};const s=e[n];return{next:[...e.slice(0,n),...e.slice(n+1)],item:s}}function E(e,t,n){const s=Math.max(0,Math.min(n,e.length));return[...e.slice(0,s),t,...e.slice(s)]}function B({status:e,label:t,isActive:n,onClick:s}){const r=`lane-tab:${e}`,{setNodeRef:o,isOver:a}=(0,p.zM)({id:r});return(0,v.jsx)("button",{ref:o,type:"button",onClick:s,className:["shrink-0 rounded-full px-md py-sm text-sm","border border-border","transition",n?"bg-foreground text-background":"bg-background text-foreground",a?"ring-2 ring-primary/40":""].join(" "),children:t})}function A({vm:e}){const{t}=(0,s.Bd)(),n=o.useMemo(()=>i.YN.map(e=>({status:e.value,title:t(`board.status.${e.value}`,e.label)})),[t]),[r,a]=o.useState(n[0]?.status??"new"),l=o.useRef(null),c=o.useRef({}),d=o.useCallback(e=>t=>{c.current[e]=t},[]),u=o.useCallback(e=>{const t=c.current[e];t&&t.scrollIntoView({behavior:"smooth",inline:"start",block:"nearest"})},[]),m=o.useRef(null),f=o.useCallback(()=>{m.current||(m.current=window.requestAnimationFrame(()=>{m.current=null;const e=l.current;if(!e)return;const t=e.scrollLeft;let s=r,o=Number.POSITIVE_INFINITY;for(const{status:e}of n){const n=c.current[e];if(!n)continue;const r=Math.abs(n.offsetLeft-t);r<o&&(o=r,s=e)}s&&s!==r&&a(s)}))},[r,n]);o.useEffect(()=>()=>{m.current&&window.cancelAnimationFrame(m.current)},[]);const{sensors:h,columnsState:x,activeMatch:b,activeLoopName:g,handleDragStart:y,handleDragOver:N,handleDragEnd:w}=function(e){const t=(0,p.FR)((0,p.MS)(p.AN,{activationConstraint:{distance:6}}),(0,p.MS)(p.IG,{activationConstraint:{delay:220,tolerance:6}})),[n,s]=o.useState(()=>D(e)),[r,a]=o.useState(null),i=o.useRef(null);o.useEffect(()=>{if(r)return;const t=i.current;if(t){const n=e.data.byStatus.get(t.toStatus)??[],s=n.findIndex(e=>e.id===t.matchId),r=s===t.toIndex||t.toIndex>=n.length&&s===n.length-1;if(-1===s||!r)return;i.current=null}s(D(e))},[e.data.byStatus,e.data.matches,r,e]);const l=o.useMemo(()=>{if(!r)return null;for(const e of n.values()){const t=e.find(e=>e.id===r);if(t)return t}return null},[r,n]),c=o.useMemo(()=>l?e.data.loopIdToName.get(l.loopId)??"":"",[l,e.data.loopIdToName]),d=o.useRef(null),u=o.useCallback(e=>{const t=String(e.active.id);a(t);const s=M(n,t)??l?.status,r=s?n.get(s)?.findIndex(e=>e.id===t)??0:0;d.current=s?{matchId:t,fromStatus:s,fromIndex:r}:null},[n,l]),m=o.useCallback(e=>{const{active:t,over:n}=e;if(!n)return;const r=String(t.id),o=String(n.id),a=t.rect.current.translated&&t.rect.current.translated.top>n.rect.top+n.rect.height/2?1:0;s(e=>{const t=function(e){const t=new Map;for(const[n,s]of e.entries())t.set(n,[...s]);return t}(e),s=M(t,r);if(!s)return e;const i=(l=o).startsWith("lane:")?l.slice(5):l.startsWith("lane-tab:")?l.slice(9):null;var l;const c=n.data.current?.sortable,d=c?.containerId??i??M(t,o);if(!d)return e;const u=t.get(s)??[],m=t.get(d)??[],f="number"==typeof c?.index?c.index+a:m.length;if(s===d){const n=u.findIndex(e=>e.id===r);if(-1===n)return e;let o=f;if(o>n&&(o-=1),n===o)return e;const{next:a,item:i}=C(u,r);return i?(t.set(s,E(a,i,o)),t):e}const{next:h,item:x}=C(u,r);return x?(t.set(s,h),t.set(d,E(m,x,f)),t):e})},[]),f=o.useCallback(async t=>{const{active:r,over:o}=t,l=d.current;if(d.current=null,a(null),!l)return;if(!o)return void s(D(e));const c=String(r.id),u=M(n,c);if(!u)return void s(D(e));const m=(n.get(u)??[]).findIndex(e=>e.id===c);i.current={matchId:c,toStatus:u,toIndex:Math.max(0,m)};try{await e.actions.onDropToStatus({matchId:c,fromStatus:l.fromStatus,fromIndex:l.fromIndex},u,Math.max(0,m))}catch{i.current=null,s(D(e))}},[n,e]);return{sensors:t,columnsState:n,activeId:r,activeMatch:l,activeLoopName:c,handleDragStart:u,handleDragOver:m,handleDragEnd:f}}(e);return(0,v.jsxs)(p.Mp,{sensors:h,collisionDetection:p.y$,onDragStart:y,onDragOver:N,onDragEnd:w,children:[(0,v.jsxs)("div",{className:"h-full min-h-0 flex flex-col overflow-hidden",children:[(0,v.jsx)("div",{className:"md:hidden shrink-0 px-md pb-sm",children:(0,v.jsx)("div",{className:"flex gap-sm overflow-x-auto no-scrollbar py-sm",children:n.map(({status:e,title:t})=>(0,v.jsx)(B,{status:e,label:t,isActive:r===e,onClick:()=>{a(e),u(e)}},e))})}),(0,v.jsx)("div",{ref:l,onScroll:f,className:["flex-1 min-h-0","overflow-x-auto overflow-y-hidden","md:overflow-x-auto","snap-x snap-mandatory md:snap-none"].join(" "),children:(0,v.jsx)("div",{className:"h-full min-h-0 flex items-stretch gap-md min-w-max px-md md:px-0",children:n.map(({status:t,title:n})=>{const s=x.get(t)??[];return(0,v.jsx)("div",{ref:d(t),className:"snap-start",children:(0,v.jsx)(k,{status:t,title:n,matches:s,loopIdToName:e.data.loopIdToName,busy:e.busy,onDelete:e.actions.onDelete})},t)})})})]}),(0,v.jsx)(p.Hd,{adjustScale:!1,children:b?(0,v.jsx)("div",{className:"w-[min(90vw,320px)]",children:(0,v.jsx)(I,{match:b,loopName:g,busy:e.busy,onDelete:e.actions.onDelete})}):null})]})}function L({matchesQ:e,isEmpty:t,children:n}){const{t:o}=(0,s.Bd)();return e.isLoading?(0,v.jsx)(r.xS,{children:o("board.loading","Loading matches…")}):e.isError?(0,v.jsx)(r.xS,{children:(0,g.u1)(e.error)}):t?(0,v.jsx)(r.xS,{children:o("board.empty","No matches yet.")}):(0,v.jsx)(v.Fragment,{children:n})}function T(){const e=x(),{t}=(0,s.Bd)(),n=e.queries.matchesQ,o=0===e.data.matches.length,a=t("board.title","Board"),i=t("board.subtitle","Drag matches between columns to update status.");return(0,v.jsxs)("div",{className:"h-full min-h-0 flex flex-col overflow-hidden",children:[(0,v.jsx)(r.zY,{title:a,subtitle:i}),(0,v.jsx)("div",{className:"flex-1 min-h-0 overflow-hidden",children:(0,v.jsx)(L,{matchesQ:n,isEmpty:o,children:(0,v.jsx)(A,{vm:e})})})]})}}}]);
//# sourceMappingURL=4665.564691bb.chunk.js.map