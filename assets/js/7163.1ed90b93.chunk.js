"use strict";(self.webpackChunkjob_tracker_dashboard=self.webpackChunkjob_tracker_dashboard||[]).push([[7163],{338(e,t,s){function a(e,t,s,a={replace:!0}){const l=new URLSearchParams(t.search);for(const[e,t]of Object.entries(s))null!=t&&!1!==t?!0!==t?l.set(e,String(t)):l.set(e,"1"):l.delete(e);const o=l.toString();e({pathname:t.pathname,search:o?`?${o}`:""},{replace:a.replace??!0})}s.d(t,{N:()=>a})},87163(e,t,s){s.r(t),s.d(t,{default:()=>k});var a=s(22022),l=s(30537),o=s(99653),n=s(68701),i=s(96540),r=s(74848);function c({open:e,busy:t,match:s,loopName:l,onClose:o,onSave:c}){const{t:d}=(0,a.Bd)(),[m,u]=(0,i.useState)(!1),[p,h]=(0,i.useState)(""),[f,g]=(0,i.useState)(""),[b,v]=(0,i.useState)(""),[x,j]=(0,i.useState)(""),[y,S]=(0,i.useState)(""),[w,C]=(0,i.useState)(""),N=t||m;(0,i.useEffect)(()=>{e&&s&&(h(s.title??""),g(s.company??""),v(s.location??""),j(s.url??""),S(function(e){if(!e)return"";const t=new Date(e);return Number.isNaN(t.getTime())?"":`${String(t.getFullYear())}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}(s.matchedAt??null)),C(String(s.description??"")))},[e,s]);const A=(0,i.useMemo)(()=>{const e={title:p.trim(),company:f.trim(),location:b.trim(),url:x.trim(),description:w.trim()};return y&&(e.matchedAt=new Date(y).toISOString()),e},[p,f,b,x,w,y]);return s?(0,r.jsx)(n.aF,{open:e,onOpenChange:e=>{e||o()},title:d("matches.modal.editTitle"),description:l?d("matches.modal.loop",{name:l}):void 0,size:"lg",showClose:!1,children:(0,r.jsxs)("div",{className:"flex flex-col gap-lg",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 gap-md md:grid-cols-2",children:[(0,r.jsx)("div",{className:"md:col-span-2",children:(0,r.jsx)(n.FO,{label:d("matches.modal.fields.title"),value:p,onChange:e=>h(e.target.value),disabled:N})}),(0,r.jsx)(n.FO,{label:d("matches.modal.fields.company"),value:f,onChange:e=>g(e.target.value),disabled:N}),(0,r.jsx)(n.FO,{label:d("matches.modal.fields.location"),value:b,onChange:e=>v(e.target.value),disabled:N}),(0,r.jsx)(n.FO,{label:d("matches.modal.fields.url"),value:x,onChange:e=>j(e.target.value),disabled:N}),(0,r.jsx)(n.FO,{label:d("matches.modal.fields.matchedAt"),type:"date",value:y,onChange:e=>S(e.target.value),disabled:N}),(0,r.jsx)("div",{className:"md:col-span-2",children:(0,r.jsx)(n.l2,{label:d("matches.modal.fields.description"),value:w,onChange:e=>C(e.target.value),disabled:N,rows:6})})]}),(0,r.jsxs)("div",{className:"flex items-center justify-end gap-sm border-t border-border pt-md",children:[(0,r.jsx)(n.$n,{variant:"outline",size:"sm",shape:"pill",shadow:"sm",disabled:N,onClick:o,children:d("matches.common.cancel")}),(0,r.jsx)(n.$n,{variant:"default",size:"sm",shape:"pill",shadow:"sm",disabled:N,onClick:async()=>{if(s)try{u(!0),await c(s.id,A),o()}finally{u(!1)}},children:d("matches.common.save")})]})]})}):null}const d={q:"",sort:"matchedAtDesc",loopIds:[],platforms:[],statuses:[]};function m(e,t){return e===t?0:e<t?-1:1}function u({children:e,onRemove:t,removeLabel:s}){return(0,r.jsxs)("span",{className:"inline-flex items-center gap-2 rounded-full border border-border bg-background px-3 py-1 text-xs text-foreground shadow-sm",children:[(0,r.jsx)("span",{className:"truncate max-w-[220px]",children:e}),(0,r.jsx)(n.$n,{variant:"ghost",size:"icon",shape:"pill",shadow:"none",onClick:t,"aria-label":s,className:(0,o.xW)("h-6 w-6 p-0","text-muted-foreground hover:text-foreground","focus-visible:ring-2 focus-visible:ring-ring"),children:"âœ•"})]})}function p(e,t){switch(t){case"matchedAtDesc":return e("matches.filters.sort.options.matchedAtDesc");case"matchedAtAsc":return e("matches.filters.sort.options.matchedAtAsc");case"titleAsc":return e("matches.filters.sort.options.titleAsc");case"companyAsc":return e("matches.filters.sort.options.companyAsc");default:return String(t)}}function h(e,t){return e(`matches.status.${t}`)}function f({value:e,onChange:t,onReset:s,loopOptions:l,platformOptions:c,statusOptions:m,totalCount:f,filteredCount:g,loopsLoading:b,page:v,totalPages:x,onPageChange:j,pageFrom:y,pageTo:S,pageDisabled:w}){const{t:C}=(0,a.Bd)(),N=s=>t({...e,...s}),A=i.useMemo(()=>function(e){const{t,filters:s,loopOptions:a}=e,l=[];if(s.q.trim()&&l.push({key:"q",label:t("matches.filters.chips.search",{q:s.q.trim()}),patch:{q:""}}),s.sort!==d.sort&&l.push({key:"sort",label:t("matches.filters.chips.sort",{value:p(t,s.sort)}),patch:{sort:d.sort}}),s.loopIds.length){const e=new Map(a.map(e=>[e.id,e.name])),o=s.loopIds.map(t=>e.get(t)??t).join(", ");l.push({key:"loops",label:t("matches.filters.chips.loops",{value:o}),patch:{loopIds:[]}})}if(s.platforms.length){const e=s.platforms.map(e=>e.toUpperCase()).join(", ");l.push({key:"platforms",label:t("matches.filters.chips.platforms",{value:e}),patch:{platforms:[]}})}if(s.statuses.length){const e=s.statuses.map(e=>h(t,e)).join(", ");l.push({key:"statuses",label:t("matches.filters.chips.statuses",{value:e}),patch:{statuses:[]}})}return l}({t:C,filters:e,loopOptions:l}),[C,e,l]),I=0===A.length;return(0,r.jsxs)(n.Zp,{variant:"default",padding:"sm",shadow:"sm",className:"space-y-md overflow-visible",children:[(0,r.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-md",children:[(0,r.jsxs)("div",{className:"flex flex-wrap items-center gap-sm",children:[(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:C("matches.filters.showing",{filtered:g,total:f})}),A.length?(0,r.jsxs)(r.Fragment,{children:[A.map(e=>(0,r.jsx)(u,{onRemove:()=>N(e.patch),removeLabel:C("matches.filters.common.removeFilter"),children:e.label},e.key)),(0,r.jsx)(n.$n,{variant:"link",size:"sm",shape:"pill",shadow:"none",onClick:s,className:(0,o.xW)("ml-1 h-auto px-0 py-0","text-xs text-muted-foreground","underline underline-offset-2","hover:text-foreground"),children:C("matches.filters.clearAll")})]}):null]}),(0,r.jsx)(n.$n,{variant:"outline",size:"sm",shape:"pill",shadow:"sm",disabled:I,onClick:s,children:C("matches.filters.reset")})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 gap-md md:grid-cols-12",children:[(0,r.jsx)("div",{className:"md:col-span-6 lg:col-span-2",children:(0,r.jsx)(n.so,{label:C("matches.filters.search.label"),value:e.q,onValueChange:e=>N({q:e}),delay:250,preset:"search",inputSize:"sm",autoComplete:"off"})}),(0,r.jsx)("div",{className:"md:col-span-6 lg:col-span-2",children:(0,r.jsx)(n.zM,{label:C("matches.filters.sort.label"),value:e.sort,onChange:e=>N({sort:e}),size:"sm",options:[{value:"matchedAtDesc",label:C("matches.filters.sort.options.matchedAtDesc")},{value:"matchedAtAsc",label:C("matches.filters.sort.options.matchedAtAsc")},{value:"titleAsc",label:C("matches.filters.sort.options.titleAsc")},{value:"companyAsc",label:C("matches.filters.sort.options.companyAsc")}]})}),(0,r.jsx)("div",{className:"md:col-span-6 lg:col-span-2",children:(0,r.jsx)(n.X,{label:C("matches.filters.loops.label"),value:e.loopIds,onChange:e=>N({loopIds:e}),options:l.map(e=>({value:e.id,label:e.name})),placeholder:C(b?"matches.filters.loops.loading":"matches.filters.loops.all"),clearLabel:C("matches.filters.common.clear"),searchable:!0,disabled:b})}),(0,r.jsx)("div",{className:"md:col-span-6 lg:col-span-2",children:(0,r.jsx)(n.X,{label:C("matches.filters.platforms.label"),value:e.platforms,onChange:e=>N({platforms:e}),options:c.map(e=>({value:e,label:e.toUpperCase()})),placeholder:C("matches.filters.platforms.all"),clearLabel:C("matches.filters.common.clear"),searchable:!0})}),(0,r.jsx)("div",{className:"md:col-span-6 lg:col-span-2",children:(0,r.jsx)(n.X,{label:C("matches.filters.statuses.label"),value:e.statuses,onChange:e=>N({statuses:e}),options:m.map(e=>({value:e,label:h(C,e)})),placeholder:C("matches.filters.statuses.all"),clearLabel:C("matches.filters.common.clear")})})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 items-center gap-md md:grid-cols-12",children:[(0,r.jsx)("div",{className:"md:col-span-4 text-xs text-muted-foreground",children:C("matches.filters.pageShowing",{from:y,to:S,total:g})}),(0,r.jsx)("div",{className:"md:col-span-8 flex justify-start md:justify-end",children:(0,r.jsx)(n.dK,{page:v,totalPages:x,onPageChange:j,disabled:w,siblingCount:1})})]})]})}var g=s(3433),b=s(55689),v=s(48330);function x(e,t){return e.localeCompare(t,void 0,{sensitivity:"base"})}function j(e){return String(e??"").toLowerCase().trim()}var y=s(95531),S=s(338);function w(e,t){const s=e.get(t);return s?s.split(",").map(e=>e.trim()).filter(Boolean):[]}function C(e){const t=e.map(e=>String(e).trim()).filter(Boolean);return t.length?t.join(","):null}function N(e){const{navigate:t,location:s,filters:a,page:l,replace:o=!0}=e;(0,S.N)(t,s,{q:a.q.trim()||null,sort:a.sort!==d.sort?a.sort:null,loop:C(a.loopIds),platform:C(a.platforms),status:C(a.statuses),page:l>1?l:null},{replace:o})}var A=s(73431);function I(){const{userId:e}=(0,b.gv)(),t=(0,g.Zp)(),s=(0,g.zy)(),{matchesQ:a,loopsQ:n,matches:r,loops:c}=function(){const{isAuthReady:e,isAuthenticated:t}=(0,b.gv)(),s=!e||!t,a=(0,l.g5)(void 0,{skip:s}),o=(0,A.fZ)(void 0,{skip:s});return{matchesQ:a,loopsQ:o,matches:a.data??[],loops:o.data??[]}}(),{busy:u,actions:p}=function(){const{isAuthReady:e,isAuthenticated:t}=(0,b.gv)(),[s,a]=(0,l.LC)(),[n,r]=(0,l.$V)(),[c,d]=(0,l.Xk)(),m=a.isLoading||r.isLoading||d.isLoading,u=i.useCallback(()=>!(!e||!t)||((0,o.me)("error","You are not signed in."),!1),[e,t]);return{busy:m,actions:{onDelete:i.useCallback(async(e,t)=>{if(u())try{await c({matchId:e,loopId:t}).unwrap(),(0,o.me)("success","Match deleted")}catch(e){(0,o.me)("error",`Failed to delete match: ${(0,y.u)(e)}`)}},[c,u]),onUpdateStatus:i.useCallback(async(e,t,a)=>{if(u())try{await s({matchId:e,loopId:t,status:a}).unwrap(),(0,o.me)("success","Match updated")}catch(e){(0,o.me)("error",`Failed to update match: ${(0,y.u)(e)}`)}},[u,s]),onSaveEdit:i.useCallback(async(e,t)=>{if(!u())throw new Error("Not signed in");try{await n({matchId:e,patch:t}).unwrap(),(0,o.me)("success","Match saved")}catch(e){throw(0,o.me)("error",`Failed to save match: ${(0,y.u)(e)}`),e}},[u,n])}}}(),{filters:h,setFilters:f,reset:S,visible:C,initialPage:I}=function(e){const{matches:t,search:s,navigate:a,location:l}=e,o=i.useMemo(()=>function(e){const t=new URLSearchParams(e),s=t.get("q")??d.q,a=t.get("sort")??d.sort,l=w(t,"loop"),o=w(t,"platform"),n=w(t,"status"),i=t.get("page");return{filters:{q:s,sort:a,loopIds:l,platforms:o,statuses:n},page:Math.max(1,Number(i??1)||1)}}(s),[s]),[n,r]=i.useState(o.filters),c=i.useRef(!1);i.useEffect(()=>{c.current||(c.current=!0,r(o.filters))},[o.filters]);const u=i.useMemo(()=>function(e,t){const s=t.q.trim(),a=s.length>0,l=new Set(t.loopIds),o=new Set(t.platforms.map(e=>e.toLowerCase())),n=new Set(t.statuses);return[...e.filter(e=>{if(t.loopIds.length&&!l.has(e.loopId))return!1;if(t.platforms.length){const t=String(e.platform??"").toLowerCase();if(!o.has(t))return!1}if(t.statuses.length&&!n.has(e.status))return!1;if(a){const t=[e.title,e.company,e.location,e.url,e.description].map(e=>String(e??"")).join(" ");if(i=s,!t.toLowerCase().includes(i.toLowerCase()))return!1}var i;return!0})].sort((e,s)=>{switch(t.sort){case"matchedAtAsc":return m(e.matchedAt,s.matchedAt);case"matchedAtDesc":return m(s.matchedAt,e.matchedAt);case"titleAsc":return String(e.title??"").localeCompare(String(s.title??""),void 0,{sensitivity:"base"});case"companyAsc":return String(e.company??"").localeCompare(String(s.company??""),void 0,{sensitivity:"base"});default:return 0}})}(t,n),[t,n]),p=i.useCallback(e=>{r(e),N({navigate:a,location:l,filters:e,page:1,replace:!0})},[a,l]),h=i.useCallback(()=>{r(d),N({navigate:a,location:l,filters:d,page:1,replace:!0})},[a,l]);return{filters:n,setFilters:p,reset:h,visible:u,initialPage:o.page}}({matches:r,search:s.search,navigate:t,location:s}),[k,M]=i.useState(null),{loopIdToName:O,platformOptions:F,statusOptions:L}=function(e,t){return{loopIdToName:i.useMemo(()=>{const e=new Map;for(const s of t)e.set(s.id,s.name);return e},[t]),platformOptions:i.useMemo(()=>{const t=new Set;for(const s of e){const e=j(s.platform);e&&t.add(e)}return Array.from(t).sort(x)},[e]),statusOptions:i.useMemo(()=>{const t=new Set;for(const s of e){const e=String(s.status??"").trim();e&&t.add(e)}return Array.from(t).sort(x)},[e])}}(r,c),$=i.useMemo(()=>function(e){const t=new WeakSet,s=e=>{if(null===e||"object"!=typeof e)return e;if(e instanceof Date)return e.toISOString();if(Array.isArray(e))return e.map(s);if(t.has(e))return"[Circular]";t.add(e);const a=e,l=Object.keys(a).sort((e,t)=>e.localeCompare(t,void 0,{sensitivity:"base"})),o={};for(const e of l)o[e]=s(a[e]);return o};try{return JSON.stringify(s(e))}catch{return String(e)}}(h),[h]),q=i.useMemo(()=>[`userId:${e??"anon"}`,`filters:${$}`,`total:${r.length}`,`visible:${C.length}`].join("|"),[e,$,r.length,C.length]),D=(0,v.W)({totalItems:C.length,pageSize:6,initialPage:I,resetKey:q}),z=i.useCallback(e=>{D.setPage(e);const a="function"==typeof e?e(D.page):e,l=Math.max(1,Number(a)||1);N({navigate:t,location:s,filters:h,page:l,replace:!0})},[D,t,s,h]),P=i.useMemo(()=>C.slice(D.offset,D.offset+D.limit),[C,D.offset,D.limit]),E=i.useMemo(()=>k?r.find(e=>e.id===k)??null:null,[k,r]),R=i.useCallback(()=>f(d),[f]),T=S??R,U=i.useCallback(async(e,t)=>{await p.onSaveEdit(e,t),M(null)},[p]);return{userId:e,queries:{matchesQ:a,loopsQ:n},busy:u,matches:r,loops:c,loopIdToName:O,platformOptions:F,statusOptions:L,filters:h,setFilters:f,onReset:T,visible:C,pagination:{...D,setPage:z},pagedMatches:P,editingMatch:E,setEditingId:M,actions:{onDelete:async e=>{const t=r.find(t=>t.id===e);t&&await p.onDelete(t.id,t.loopId)},onUpdateStatus:async(e,t)=>{const s=r.find(t=>t.id===e);s&&await p.onUpdateStatus(s.id,s.loopId,t)},onSaveEdit:U}}}function k(){const{t:e}=(0,a.Bd)(),t=I(),{matchesQ:s,loopsQ:i}=t.queries;return s.isLoading?(0,r.jsxs)("div",{className:"w-full h-full flex flex-col min-h-0",children:[(0,r.jsx)(n.zY,{title:e("matches.list.title"),subtitle:e("matches.list.subtitle")}),(0,r.jsx)(n.xS,{children:e("matches.common.loading")})]}):s.isError?(0,r.jsxs)("div",{className:"w-full h-full flex flex-col min-h-0",children:[(0,r.jsx)(n.zY,{title:e("matches.list.title"),subtitle:e("matches.list.subtitle")}),(0,r.jsx)(n.xS,{children:(0,o.u1)(s.error)})]}):0===t.matches.length?(0,r.jsxs)("div",{className:"w-full h-full flex flex-col min-h-0",children:[(0,r.jsx)(n.zY,{title:e("matches.list.title"),subtitle:e("matches.list.subtitle")}),(0,r.jsx)(n.xS,{children:e("matches.list.empty")})]}):(0,r.jsxs)("div",{className:"w-full h-full flex flex-col min-h-0",children:[(0,r.jsx)(n.zY,{title:e("matches.list.title"),subtitle:e("matches.list.subtitle")}),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(f,{value:t.filters,onChange:t.setFilters,onReset:t.onReset,loopOptions:t.loops.map(e=>({id:e.id,name:e.name})),platformOptions:t.platformOptions,statusOptions:t.statusOptions,totalCount:t.matches.length,filteredCount:t.visible.length,loopsLoading:i.isLoading,page:t.pagination.page,totalPages:t.pagination.totalPages,onPageChange:t.pagination.setPage,pageFrom:t.pagination.info.from,pageTo:t.pagination.info.to,pageDisabled:t.busy||s.isFetching}),(0,r.jsx)("div",{className:"flex-1 min-h-0 overflow-auto pt-md",children:(0,r.jsx)("div",{className:"grid grid-cols-1 gap-md",children:t.pagedMatches.map(e=>(0,r.jsx)(l.Cq,{match:e,loopName:t.loopIdToName.get(e.loopId)??"",busy:t.busy,onUpdateStatus:t.actions.onUpdateStatus,onDelete:t.actions.onDelete,onEdit:t.setEditingId},e.id))})}),(0,r.jsx)(c,{open:Boolean(t.editingMatch),busy:t.busy,loopName:t.editingMatch?t.loopIdToName.get(t.editingMatch.loopId)??"":"",match:t.editingMatch,onClose:()=>t.setEditingId(null),onSave:t.actions.onSaveEdit})]})]})}}}]);
//# sourceMappingURL=7163.1ed90b93.chunk.js.map